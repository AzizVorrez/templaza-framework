<?php
//defined('TEMPLAZA_FRAMEWORK') or exit();

//var_dump("body");

use TemPlazaFramework\Functions;
use TemPlazaFramework\Templates;

global $wp_query;

$options        = Functions::get_theme_options();

if($options && isset($options['layout']) && $options['layout']){

    $layout = $options['layout'];
//    $layout = '[{"type":"section","params":{"tz_admin_label":"Top Sidebar","title":"Section Title","layout_type":"container","custom_container_class":"","tz_customclass":"","tz_customid":"","background":{"background-color":"","background-repeat":"","background-size":"","background-attachment":"","background-position":"","background-image":"","media":{"id":"","height":"","width":"","thumbnail":""}},"text_color":"","link_color":{"regular":"","hover":"","active":""},"margin":{"margin-top":"","margin-right":"","margin-bottom":"","margin-left":"","units":"px"},"padding":{"padding-top":"","padding-right":"","padding-bottom":"","padding-left":"","units":"px"},"hideonxs":"","hideonsm":"","hideonmd":"","hideonlg":"","hideonxl":""},"elements":[{"title":"Row","type":"row","params":{"tz_customclass":"","tz_customid":"","background":{"background-color":"","background-repeat":"","background-size":"","background-attachment":"","background-position":"","background-image":"","media":{"id":"","height":"","width":"","thumbnail":""}},"hideonxs":"","hideonsm":"","hideonmd":"","hideonlg":"","hideonxl":""},"elements":[{"type":"column","size":3,"params":{"tz_customclass":"","tz_customid":"","background":{"background-color":"","background-repeat":"","background-size":"","background-attachment":"","background-position":"","background-image":"","media":{"id":"","height":"","width":"","thumbnail":""}},"text_color":"","link_color":{"regular":"","hover":"","active":""},"xs_colum_size":"","xs_visibility":"","sm_colum_size":"","sm_visibility":"","md_colum_size":"","md_visibility":"","lg_colum_size":"","lg_visibility":"","xl_colum_size":"","xl_visibility":""},"elements":[{"type":"social","elements":[],"params":{"tz_admin_label":"","tz_customclass":"","tz_customid":""},"id":"991597056845151","title":"Social","icon":"fas fa-share-alt","admin_label":""}],"id":"421596917622157"},{"type":"column","elements":[{"type":"contact","elements":[],"params":{"tz_admin_label":"","tz_customclass":"text-right","tz_customid":""},"id":"341596918530947","title":"Contact","icon":"far fa-address-card","admin_label":""}],"params":{"tz_customclass":"","tz_customid":"","background":{"background-color":"","background-repeat":"","background-size":"","background-attachment":"","background-position":"","background-image":"","media":{"id":"","height":"","width":"","thumbnail":""}},"text_color":"","link_color":{"regular":"","hover":"","active":""},"xs_colum_size":"","xs_visibility":"","sm_colum_size":"","sm_visibility":"","md_colum_size":"","md_visibility":"","lg_colum_size":"","lg_visibility":"","xl_colum_size":"","xl_visibility":""},"size":9}],"id":"801596732623601"}],"id":"961596732620441","admin_label":"Top Sidebar"},{"type":"section","admin_label":"Header","params":{"tz_admin_label":"Header","title":"Section Title","layout_type":"container","custom_container_class":"","tz_customclass":"","tz_customid":"","background":{"background-color":"","background-repeat":"","background-size":"","background-attachment":"","background-position":"","background-image":"","media":{"id":"","height":"","width":"","thumbnail":""}},"text_color":"","link_color":{"regular":"","hover":"","active":""},"margin":{"margin-top":"","margin-right":"","margin-bottom":"","margin-left":"","units":"px"},"padding":{"padding-top":"","padding-right":"","padding-bottom":"","padding-left":"","units":"px"},"hideonxs":"","hideonsm":"","hideonmd":"","hideonlg":"","hideonxl":""},"elements":[{"title":"Row","type":"row","params":{"tz_customclass":"","tz_customid":"","background":{"background-color":"","background-repeat":"","background-size":"","background-attachment":"","background-position":"","background-image":"","media":{"id":"","height":"","width":"","thumbnail":""}},"hideonxs":"","hideonsm":"","hideonmd":"","hideonlg":"","hideonxl":""},"elements":[{"type":"column","size":12,"params":{"tz_customclass":"test-2","tz_customid":"1596708049","background":{"background-color":"","background-repeat":"","background-size":"","background-attachment":"","background-position":"","background-image":"","media":{"id":"","height":"","width":"","thumbnail":""}},"text_color":"","link_color":{"regular":"","hover":"","active":""},"xs_colum_size":"","xs_visibility":"","sm_colum_size":"","sm_visibility":"","md_colum_size":"","md_visibility":"","lg_colum_size":"12","lg_visibility":"","xl_colum_size":"","xl_visibility":""},"elements":[{"type":"header","elements":[],"params":{"tz_admin_label":"","tz_customclass":"","tz_customid":""},"id":"321596856883257","title":"Header","icon":"el el-tasks"}],"id":"771596732553009"}],"id":"881596732549584"}],"id":"801596732546810"},{"type":"section","admin_label":"Footer","params":{"tz_admin_label":"Footer","title":"","layout_type":"container","custom_container_class":"","tz_customclass":"","tz_customid":"","background":{"background-color":"","background-repeat":"","background-size":"","background-attachment":"","background-position":"","background-image":"","media":{"id":"","height":"","width":"","thumbnail":""}},"text_color":"","link_color":{"regular":"","hover":"","active":""},"margin":{"margin-top":"","margin-right":"","margin-bottom":"","margin-left":"","units":"px"},"padding":{"padding-top":"","padding-right":"","padding-bottom":"","padding-left":"","units":"px"},"hideonxs":"","hideonsm":"","hideonmd":"","hideonlg":"","hideonxl":""},"elements":[{"title":"Row","type":"row","params":{"tz_customclass":"","tz_customid":"","background":{"background-color":"","background-repeat":"","background-size":"","background-attachment":"","background-position":"","background-image":"","media":{"id":"","height":"","width":"","thumbnail":""}},"hideonxs":"","hideonsm":"","hideonmd":"","hideonlg":"","hideonxl":""},"elements":[{"type":"column","size":6,"params":{"tz_customclass":"test-2","tz_customid":"","background":{"background-color":"","background-repeat":"","background-size":"","background-attachment":"","background-position":"","background-image":"","media":{"id":"","height":"","width":"","thumbnail":""}},"text_color":"","link_color":{"regular":"","hover":"","active":""},"xs_colum_size":"","xs_visibility":"","sm_colum_size":"","sm_visibility":"","md_colum_size":"","md_visibility":"","lg_colum_size":"12","lg_visibility":"","xl_colum_size":"","xl_visibility":""},"elements":[{"type":"copyright","elements":[],"params":{"tz_admin_label":"","tz_customclass":"","tz_customid":""},"id":"411596856478440","title":"Copyright","icon":"far fa-copyright"}],"id":"781596907307295"},{"type":"column","elements":[{"type":"sidebar","elements":[],"params":{"tz_admin_label":"","sidebar":"sidebar-footer1","tz_customclass":"","tz_customid":""},"id":"141597114973425","title":"Sidebar","icon":"el el-credit-card rotate-n90","admin_label":""}],"params":{"tz_customclass":"","tz_customid":"","background":{"background-color":"","background-repeat":"","background-size":"","background-attachment":"","background-position":"","background-image":"","media":{"id":"","height":"","width":"","thumbnail":""}},"text_color":"","link_color":{"regular":"","hover":"","active":""},"xs_colum_size":"","xs_visibility":"","sm_colum_size":"","sm_visibility":"","md_colum_size":"","md_visibility":"","lg_colum_size":"","lg_visibility":"","xl_colum_size":"","xl_visibility":""},"size":6},{"type":"column","elements":[],"params":{"tz_customclass":"","tz_customid":"","background":{"background-color":"","background-repeat":"","background-size":"","background-attachment":"","background-position":"","background-image":"","media":{"id":"","height":"","width":"","thumbnail":""}},"text_color":"","link_color":{"regular":"","hover":"","active":""},"xs_colum_size":"","xs_visibility":"","sm_colum_size":"","sm_visibility":"","md_colum_size":"","md_visibility":"","lg_colum_size":"","lg_visibility":"","xl_colum_size":"","xl_visibility":""},"size":12,"id":"371597115093912"}],"id":"881596732549584"}],"id":"1061596857468504"}]';
//    $layout = '[{"type":"section","params":{"tz_admin_label":"Top Sidebar","title":"Section Title","layout_type":"container","custom_container_class":"","tz_customclass":"","tz_customid":"","background":{"background-color":"","background-repeat":"","background-size":"","background-attachment":"","background-position":"","background-image":"","media":{"id":"","height":"","width":"","thumbnail":""}},"text_color":"","link_color":{"regular":"","hover":"","active":""},"margin":{"margin-top":"","margin-right":"","margin-bottom":"","margin-left":"","units":"px"},"padding":{"padding-top":"","padding-right":"","padding-bottom":"","padding-left":"","units":"px"},"hideonxs":"","hideonsm":"","hideonmd":"","hideonlg":"","hideonxl":""},"elements":[{"title":"Row","type":"row","params":{"tz_customclass":"","tz_customid":"","background":{"background-color":"","background-repeat":"","background-size":"","background-attachment":"","background-position":"","background-image":"","media":{"id":"","height":"","width":"","thumbnail":""}},"hideonxs":"","hideonsm":"","hideonmd":"","hideonlg":"","hideonxl":""},"elements":[{"type":"column","size":3,"params":{"tz_customclass":"","tz_customid":"","background":{"background-color":"","background-repeat":"","background-size":"","background-attachment":"","background-position":"","background-image":"","media":{"id":"","height":"","width":"","thumbnail":""}},"text_color":"","link_color":{"regular":"","hover":"","active":""},"xs_colum_size":"","xs_visibility":"","sm_colum_size":"","sm_visibility":"","md_colum_size":"","md_visibility":"","lg_colum_size":"","lg_visibility":"","xl_colum_size":"","xl_visibility":""},"elements":[],"id":"421596917622157"},{"type":"column","elements":[],"params":{"tz_customclass":"","tz_customid":"","background":{"background-color":"","background-repeat":"","background-size":"","background-attachment":"","background-position":"","background-image":"","media":{"id":"","height":"","width":"","thumbnail":""}},"text_color":"","link_color":{"regular":"","hover":"","active":""},"xs_colum_size":"","xs_visibility":"","sm_colum_size":"","sm_visibility":"","md_colum_size":"","md_visibility":"","lg_colum_size":"","lg_visibility":"","xl_colum_size":"","xl_visibility":""},"size":9}],"id":"801596732623601"}],"id":"961596732620441","admin_label":"Top Sidebar"},{"type":"section","admin_label":"Header","params":{"tz_admin_label":"Header","title":"Section Title","layout_type":"container","custom_container_class":"","tz_customclass":"","tz_customid":"","background":{"background-color":"","background-repeat":"","background-size":"","background-attachment":"","background-position":"","background-image":"","media":{"id":"","height":"","width":"","thumbnail":""}},"text_color":"","link_color":{"regular":"","hover":"","active":""},"margin":{"margin-top":"","margin-right":"","margin-bottom":"","margin-left":"","units":"px"},"padding":{"padding-top":"","padding-right":"","padding-bottom":"","padding-left":"","units":"px"},"hideonxs":"","hideonsm":"","hideonmd":"","hideonlg":"","hideonxl":""},"elements":[{"title":"Row","type":"row","params":{"tz_customclass":"","tz_customid":"","background":{"background-color":"","background-repeat":"","background-size":"","background-attachment":"","background-position":"","background-image":"","media":{"id":"","height":"","width":"","thumbnail":""}},"hideonxs":"","hideonsm":"","hideonmd":"","hideonlg":"","hideonxl":""},"elements":[{"type":"column","size":12,"params":{"tz_customclass":"test-2","tz_customid":"1596708049","background":{"background-color":"","background-repeat":"","background-size":"","background-attachment":"","background-position":"","background-image":"","media":{"id":"","height":"","width":"","thumbnail":""}},"text_color":"","link_color":{"regular":"","hover":"","active":""},"xs_colum_size":"","xs_visibility":"","sm_colum_size":"","sm_visibility":"","md_colum_size":"","md_visibility":"","lg_colum_size":"12","lg_visibility":"","xl_colum_size":"","xl_visibility":""},"elements":[],"id":"771596732553009"}],"id":"881596732549584"}],"id":"801596732546810"},{"type":"section","admin_label":"Footer","params":{"tz_admin_label":"Footer","title":"","layout_type":"container","custom_container_class":"","tz_customclass":"","tz_customid":"","background":{"background-color":"","background-repeat":"","background-size":"","background-attachment":"","background-position":"","background-image":"","media":{"id":"","height":"","width":"","thumbnail":""}},"text_color":"","link_color":{"regular":"","hover":"","active":""},"margin":{"margin-top":"","margin-right":"","margin-bottom":"","margin-left":"","units":"px"},"padding":{"padding-top":"","padding-right":"","padding-bottom":"","padding-left":"","units":"px"},"hideonxs":"","hideonsm":"","hideonmd":"","hideonlg":"","hideonxl":""},"elements":[{"title":"Row","type":"row","params":{"tz_customclass":"","tz_customid":"","background":{"background-color":"","background-repeat":"","background-size":"","background-attachment":"","background-position":"","background-image":"","media":{"id":"","height":"","width":"","thumbnail":""}},"hideonxs":"","hideonsm":"","hideonmd":"","hideonlg":"","hideonxl":""},"elements":[{"type":"column","size":6,"params":{"tz_customclass":"test-2","tz_customid":"","background":{"background-color":"","background-repeat":"","background-size":"","background-attachment":"","background-position":"","background-image":"","media":{"id":"","height":"","width":"","thumbnail":""}},"text_color":"","link_color":{"regular":"","hover":"","active":""},"xs_colum_size":"","xs_visibility":"","sm_colum_size":"","sm_visibility":"","md_colum_size":"","md_visibility":"","lg_colum_size":"12","lg_visibility":"","xl_colum_size":"","xl_visibility":""},"elements":[],"id":"781596907307295"},{"type":"column","elements":[],"params":{"tz_customclass":"","tz_customid":"","background":{"background-color":"","background-repeat":"","background-size":"","background-attachment":"","background-position":"","background-image":"","media":{"id":"","height":"","width":"","thumbnail":""}},"text_color":"","link_color":{"regular":"","hover":"","active":""},"xs_colum_size":"","xs_visibility":"","sm_colum_size":"","sm_visibility":"","md_colum_size":"","md_visibility":"","lg_colum_size":"","lg_visibility":"","xl_colum_size":"","xl_visibility":""},"size":6},{"type":"column","elements":[],"params":{"tz_customclass":"","tz_customid":"","background":{"background-color":"","background-repeat":"","background-size":"","background-attachment":"","background-position":"","background-image":"","media":{"id":"","height":"","width":"","thumbnail":""}},"text_color":"","link_color":{"regular":"","hover":"","active":""},"xs_colum_size":"","xs_visibility":"","sm_colum_size":"","sm_visibility":"","md_colum_size":"","md_visibility":"","lg_colum_size":"","lg_visibility":"","xl_colum_size":"","xl_visibility":""},"size":12,"id":"371597115093912"}],"id":"881596732549584"}],"id":"1061596857468504"}]';
    $layout = json_decode($layout, true);


    Functions::generate_option_to_shortcode($layout, $tree);
//    var_dump(get_shortcode_regex());

    if(count($tree)) {
        $shortcode = array_pop($tree);
//        if(get_the_ID() == 186){
//////            var_dump($layout);
//            var_dump($shortcode);
//////            var_dump($tree);
//        }
        if(!empty($shortcode)) {
            do{
                $shortcode = trim(do_shortcode($shortcode));
            }while(preg_match_all( '/' . get_shortcode_regex() . '/', $shortcode, $matches, PREG_SET_ORDER ));
            echo $shortcode;
        }
    }
}